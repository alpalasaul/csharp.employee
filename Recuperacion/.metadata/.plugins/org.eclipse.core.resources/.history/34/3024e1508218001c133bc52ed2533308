package com.cmc.eval.servicios;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.text.ParseException;
import java.util.ArrayList;
import java.util.Date;

import com.cmc.eval.commons.ArchivoException;

public class AdminArchivos {
	
	private String rutaArchivo;
	
	public AdminArchivos(String rutaArchivo) {
		this.rutaArchivo = rutaArchivo;
	}
	
	public ArrayList<String> leer() throws ArchivoException {
		File file = new File(this.rutaArchivo);
		System.out.println("*****************************************");
		System.out.println(file.getAbsolutePath() + " --------------------------------------- ");
		System.out.println("*****************************************");
		FileReader fileReader = null;
		BufferedReader br = null;
		ArrayList<String> archivos = new ArrayList<String>();
		String linea = "";
		String[] separado;
		String p = null;
		try {
			fileReader = new FileReader(file);
			br = new BufferedReader(fileReader);
			while ((linea = br.readLine()) != null) {
				separado = linea.split("-");
				p = new String(separado[2], separado[0], separado[1]); // cedu nom apel edad
				p.setEdad(Integer.parseInt(separado[3]));
				//String fechaNacimiento = separado[4];
				
				//Date fechaConvertida = DateUtil.convertirDate(fechaNacimiento);
				
				//String fechaStringConvertida = DateUtil.convertirDate2(fechaConvertida);
				
				//p.setFechaCreacion(DateUtil.convertir(new Date()));
				
				//p.setFechaNacimiento(fechaStringConvertida);
				
				archivos.add(p);
			}
			br.close();
		} catch (FileNotFoundException e) {
//			logger.error("No existe el archivo ", e);
			System.out.println("No existe el archivo " + e);
			throw new ArchivoException("No existe el archivo: " + this.rutaArchivo);
		} catch (IOException e) {
//			logger.error("Error al leer el archivo", e);
			System.out.println("Error al leer el archivo" + e);
			throw new ArchivoException("Error al leer el archivo: " + this.rutaArchivo);
		} catch (ParseException e) {
			e.printStackTrace();
			System.out.println("Error al convertir fecha" + e);
		} finally {
			try {
				if (br != null) { // Eliminamos la posibilidad de NullPointerExeption
					br.close();
				}
			} catch (IOException e) {
				System.out.println("Error al cerrar el BufferedReader br " + e);
//				logger.error("Error al cerrar el BufferedReader br ", e);
			}
			try {
				if (fileReader != null) {
					fileReader.close();
				}
			} catch (IOException e) {
				System.out.println("Error al cerrar el FileReader fr " + e);
//				logger.error("Error al cerrar el FileReader fr ", e);
			}
		}
		return archivos;

}
